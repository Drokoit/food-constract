function displayDishes() {
    const soupContainer = document.getElementById('soup');
    const saladContainer = document.getElementById('salad');
    const mainDishContainer = document.getElementById('main_dish');
    const dessertContainer = document.getElementById('dessert');
    const drinkContainer = document.getElementById('drink');

    if (!dishes || dishes.length === 0) {
        console.error('Массив dishes пуст или не определен');
        return;
    }
    const sortedDishes = [...dishes].sort((a, b) => a.name.localeCompare(b.name));

    sortedDishes.forEach(dish => {
        switch (dish.category.toLowerCase()) {
            case 'soup':
                soupContainer.appendChild(createDishElement(dish));
                break;
            case 'salad':
                saladContainer.appendChild(createDishElement(dish));
                break;
            case 'main_dish':
                mainDishContainer.appendChild(createDishElement(dish));
                break;
            case 'dessert':
                dessertContainer.appendChild(createDishElement(dish));
                break;
            case 'drink':
                drinkContainer.appendChild(createDishElement(dish));
                break;
        }
    });
}

function createDishElement(dish) {
    const dishElement = document.createElement('div');
    dishElement.className = 'dish-item';
    dishElement.setAttribute('data-dish', dish.keyword)
    dishElement.innerHTML = `
        <img src="${dish.image}" alt="${dish.name}">
        <p>${dish.name}</p>
        <p>${dish.price} руб</p>
        <p>${dish.count}</p>
        <button>Добавить</button>
    `;
    return dishElement;
}

function filterDishes(container, kind, button) {
    const allDishes = Array.from(container.children);
    const filterButtons = container.previousElementSibling.querySelectorAll('button[data-kind]');

    filterButtons.forEach(btn => {
        if (btn !== button) {
            btn.classList.remove('active');
        }
    });

    const isActive = button.classList.toggle('active');

    if (isActive) {
        allDishes.forEach(dish => {
            const dishKind = dishes.find(d => d.keyword === dish.getAttribute('data-dish')).kind;
            dish.style.display = dishKind === kind ? 'block' : 'none';
        });
    } else {
        allDishes.forEach(dish => {
            dish.style.display = 'block';
        });
    }
}
window.addEventListener('load', displayDishes);




let order = {
    soup: null,
    salad: null,
    main_dish: null,
    dessert: null,
    drink: null
};

let totalPrice = 0;

function updateOrder(type, dish) {
    order[type] = dish;
    updateOrderDisplay();
    updateTotalPrice();
    updateHiddenInputs();
}

function updateOrderDisplay() {
    const orderSection = document.getElementById('order');
    orderSection.innerHTML = '';

    let hasDishes = false;
    
    for (let type in order) {
        if (order[type]) {
            hasDishes = true;
            const dishElement = document.createElement('p');
            dishElement.textContent = `${order[type].name} - ${order[type].price} руб.`;
            orderSection.appendChild(dishElement);
        }
        else {
            const message = document.createElement('p');
            message.textContent = type === 'drink' ? "Напиток не выбран" : "Блюдо не выбрано";
            orderSection.appendChild(message);
        }
    }
    if (!hasDishes) {
        orderSection.innerHTML = '<p>Ничего не выбрано</p>';
    }
}

function updateTotalPrice() {
    totalPrice = 0;
    for (let type in order) {
        if (order[type]) {
            totalPrice += order[type].price;
        }
    }
    const totalPriceElement = document.getElementById('totalPriceDisplay');
    totalPriceElement.textContent = totalPrice > 0 ? `Итого: ${totalPrice} руб.` : '';
}

function updateHiddenInputs() {
    for (let type in order) {
        const input = document.getElementById(`${type}Order`);
        input.value = order[type] ? order[type].name : '';
    }
}

function resetOrder() {
    order = {
        soup: null,
        salad: null,
        main_dish: null,
        dessert: null,
        drink: null
    };
    totalPrice = 0;
    updateOrderDisplay();
    updateTotalPrice();
    updateHiddenInputs();
    document.getElementById('orderForm').reset();
}

document.addEventListener('DOMContentLoaded', () => {

    updateOrderDisplay();

    document.querySelectorAll('.dish-block').forEach(section => {
        section.addEventListener('click', (e) => {
            if (e.target.tagName === 'BUTTON') {
                const dishElement = e.target.closest('.dish-item');
                const dishKeyword = dishElement.getAttribute('data-dish');
                const dish = dishes.find(d => d.keyword === dishKeyword);
                const type = dish.category;
                updateOrder(type, dish);
            }
        });
    });

    document.getElementById('resetBtn').addEventListener('click', resetOrder);
});